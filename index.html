<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controllo LED con Blynk</title>
  <script>
    const PROXY_URL = "https://cors-anywhere.herokuapp.com/";  // URL del proxy
    const API_URL = "https://blynk.cloud/external/api/update?token=grYpUsFvzBxM6U0F_N1HM-_sub0_Ffhu&";  // URL API Blynk

    async function toggleLED(state) {
      const ledState = `V2=${state ? 1 : 0}`;  // Crea il parametro per il virtual pin
      try {
        // Usa il proxy per fare la richiesta
        const response = await fetch(PROXY_URL + API_URL + ledState, {
          method: 'GET',  // Metodo di richiesta GET
          mode: 'cors',   // Modalit√† CORS
          headers: {
            'Content-Type': 'application/json',  // Tipo di contenuto
          },
        });

        // Verifica la risposta
        if (response.ok) {
          document.getElementById("status").innerText = `LED ${state ? "ACCESO" : "SPENTO"}`;
        } else {
          const errorText = await response.text();
          console.error("Errore nella risposta:", errorText);
          document.getElementById("status").innerText = "Errore nella richiesta!";
        }
      } catch (error) {
        console.error("Errore nella connessione:", error);
        document.getElementById("status").innerText = "Errore nella connessione!";
      }
    }
  </script>
</head>
<body>
  <h1>Controllo LED con Blynk</h1>
  <button onclick="toggleLED(true)">Accendi LED</button>
  <button onclick="toggleLED(false)">Spegni LED</button>
  <p id="status">Stato LED: Non impostato</p>
</body>
</html>
